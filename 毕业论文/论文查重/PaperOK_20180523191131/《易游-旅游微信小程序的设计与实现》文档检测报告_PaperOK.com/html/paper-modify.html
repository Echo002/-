<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Frameset//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-frameset.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>无标题文档</title>
		<link href="img/style.css" rel="stylesheet" type="text/css" media="all" />
		<script>
			function save(){
				var f = document.papermodifyForm;
				f.action = "http://api.xueshuda.com/paper_modify/save.do";
				f.target = "papermodifyFrame";
				f.submit();
				
				document.getElementById("modified").innerHTML = "（最后保存时间："+getNow()+"）";
			}
			
			function editFocus(){
				document.onkeydown = function(e){
					//Ctrl+S
					if (e.ctrlKey == true && e.keyCode == 83) {
						save();
						return false;
					}
				};
				document.getElementById("ctrlS").style.display = "inline";
			}
			
			function editBlur(){
				document.onkeydown = null;
				document.getElementById("ctrlS").style.display = "none";
			}
			
			function exp(){
				var f = document.papermodifyForm;
				f.action = "http://api.xueshuda.com/paper_modify/exp.do";
				f.target = "papermodifyFrame";
				f.submit();
			}
			
			function check(){
				var f = document.papermodifyForm;
				f.action = "http://u.paperok.com/check/submit.do";
				f.target = "_blank";
				f.submit();
			}
			
			function load_cb(data){
				if(data.errcode == 0){
					var text = data.text;
					var modified = data.modified;
					
					document.getElementById("originalText").value = text;
					document.getElementById("modified").innerHTML = "（最后保存时间："+modified+"）";
					//alert("加载成功");
				}else{
					document.getElementById("modified").innerHTML = "";
				}
			}
			
			function load(){
				document.getElementById("modified").innerHTML = "正在加载上次保存的内容...";
				var url = "http://api.xueshuda.com/paper_modify/jsonp/get.do?uuid=462a4845-0db9-4360-a259-e33f5cb770af&callback=load_cb&r="+Math.random();
				var script = document.createElement('script');
				script.setAttribute('src', url);
				document.getElementsByTagName('head')[0].appendChild(script);
			}
			 
			window.onload = function(){
				document.getElementById("originalText").onfocus = editFocus;
				document.getElementById("originalText").onblur = editBlur;
				
				if(navigator && navigator.onLine === false){
					alert("您的电脑没有联网，无法自动加载上次保存的内容");
				}else{
					load();
				}
			};
			
			function getNow() {
				var date = new Date();
				var y = date.getFullYear();
				var m = date.getMonth() + 1;
				m = m < 10 ? "0" + m : m;
				var d = date.getDate();
				d = d < 10 ? "0" + d : d;
				var h = date.getHours();
				h = h < 10 ? "0" + h : h;
				var mi = date.getMinutes();
				mi = mi < 10 ? "0" + mi : mi;
				var s = date.getSeconds();
				s = s < 10 ? "0" + s : s;
				var curr =  y + "-" + m + "-" + d +" "+ h + ":" + mi + ":" + s;
				return curr;
			}
		</script>
	</head>
	<body id="paper-modify">
		<div class="operate">
			<a href="javascript:save()">保存<span id="ctrlS">（Ctrl+S）</span></a>
			<a href="javascript:exp()">导出</a>
			<a href="javascript:check()">提交查重</a>
			<font color="#ff4500"><strong>温馨提示：修改后，请点“保存”按钮，或“导出”到本地保存。</strong></font>
		</div>
		
		<div id="paper-edit-title">编辑区<span id="modified"></span></div>
		<div id="full-text-title">详细报告</div>
		<div id="simi-reult-title">片段相似详情</div>
		
		<div id="paper-edit">
			<form id="papermodifyForm" name="papermodifyForm" method="post" enctype="multipart/form-data">
				<input type="hidden" name="uuid" value="462a4845-0db9-4360-a259-e33f5cb770af"/>
				<input type="hidden" name="code" value="paperok"/>
				<input type="hidden" name="title" value="易游-旅游微信小程序的设计与实现"/>
				<input type="hidden" name="author" value="徐高"/>
				<textarea id="originalText" name="text">1 绪论

1.1目的及意义
近年来，旅游市场越来越火爆，而旅游行业却乱象层出不穷、围绕旅途提供的互联网服务质量参差不齐。针对以上问题，本研究为建立一个在旅行中方便导游进行游客管理、为游客提供服务的系统。以微信小程序作为旅途信息服务的载体，能很好地将传统的旅行过程中所需的各种信息服务移动化，为用户提供全新的服务体验，构建一个实用高效的综合旅途服务系统。
我国是最大的旅游市场。这几年来国民旅游热情持续高涨。“靠山吃山，靠水吃水”，景区的居民靠景点盈利，本是无可厚非，但是各种小长假到来时，充斥在各路媒体的头版头条总是关于旅游过程中不合理的情况。这困扰着游客、影响正常旅游秩序，究其原因，还是因为供求关系不平衡和信息不透明所导致。
随着移动互联网这几年突飞猛进式的发展，“互联网+”为解决这一问题提供了很好的思路和方法。正如蚂蜂窝数据研究中心负责人所说：“互联网将让信息变得更加透明。当互联网技术深入到旅游行业之后，留给不法分子的空间将会越来越小。”在互联网旅游从业者看来，互联网确实可以在消除旅游中的各种混乱，净化旅游环境上发挥很大的作用。阿里旅行的副总裁周正表示，企业获取用户数据具有很大的优势，可以利用这一优势来联合政府建立信用档案库，来发挥它更大的优势。周正同时也表示，阿里也正和当地居民或是旅行社建立信用档案库，打造互联网与本地结合的合伙人模式，并加强信用档案数据库基础设施的建设。“互联网+旅游”正在发挥它自身的作用，真正用信息武装中国的旅游服务产业。互联网作为消费者获取信息的主要途径，一定也会成为旅游商家们竞争的主要市场，这样也能从侧面整体提升旅游业的服务质量。在旅游领域，越来越多的企业正在主动迎接互联网，并通过这一方式进行推销。尽量在旅游业在网络营销上相对于其他的产业有许多不成熟的地方，也有许多的旅游部门选择与互联网公司合作进行推广，选择网络成为推广服务的主要渠道，通过大数据的分析，也能在短时间内实现营销的精细化。
基于移动设备平台的地图类、旅游类应用已经越来越普遍，但是还是存在一定的问题：
（1）传统的移动应用过于臃肿复杂。纵观目前的旅游应用，往往需要手机腾出内存来安装，而在旅途结束回归日常生活后，用户往往会由于使用价值不是很大而又卸载，需要时再次安装；
（2）信息整合度不高，没有针对性。目前的手机应用往往无法做到对于单次旅途所需信息的智能整合，导致一次旅行需要使用多个App(Application)来协同完成，用户体验受到影响；
（3）个人信息的安全问题日益凸显。每安装一次App，用户就需要注册填写个人信息，而App本身也存在一定的漏洞，增加了用户数据泄露的隐患。
综上所述，本文提出了一套基于微信小程序的旅途服务系统，该系统由前端（HTML/CSS/Java Script）和后端（PHP/SQL数据库/腾讯云）组成，针对导游、用户两类群体在旅途中使用，在导游端有路线规划、游客管理、旅途信息发布等功能；在游客端有景点介绍、游客论坛、旅途消费、投诉通道等功能。


1.2国内研究现状分析
小程序是微信2017年1月9日正式上线的一个划时代产品。它是一种不需要下载安装即可使用的应用，实现了应用“触手可及”的梦想，用户扫一扫或搜一下即可打开应用。也体现了“用完即走”的理念，用户不用关心是否安装太多应用的问题。应用将无处不在，随时可用，但又无需安装卸载。
目前，国内Android和IOS程序开发日渐成熟，由于App存在以上存在的一系列问题。使得微信小程序在“旅行”这一特定场景中更好地发挥它独特的优势。实际上，从功能的角度，小程序已经替代了一些低频出现的App和体验不佳的App，不管从哪个角度来看，对于开发者和微信都是有好处的。具体如下：
去中心化，核心功能齐全。微信小程序的设计目标就是“随取随用”，有针对性地保留核心功能；
解放手机空间，节省流量。微信小程序无需下载、安装，帮助用户节省流量，这一特性在旅途中更能体现其优势；
微信用户基数大，易于推广，无需刻意培养用于黏度。
可见，要在旅行中进行信息管理，使用微信小程序这一平台更加合适、可行性更高。



1.3主要研究内容
“易游”微信小程序针对两类不同人群设计两套不同的系统：
针对导游，本系统功能设计主要有：通知发布、游客管理、电子围栏、游客心声、急救知识五个功能模块；针对游客，本系统功能设计主要有：景点介绍、电子地图、汇率转换、投诉反馈、行程查询四个功能模块。信息与互联网实时同步，导游端可以接受和推送消息，方便导游管理和查看信息；游客端在绑定导游后，可以接受来自导游的推送消息，推送内容包括导游个人介绍、行程安排、旅途攻略等实用信息。

1.4 论文章节安排
	第一章 绪论 简述了本作品的研究意义和目的，同时结合行业背景对相关产业进行分析。
	第二章 相关技术分析 简要分析微信小程序开发所需的技术以及掌握微信开发须知的新特性扩展。

1.5 本章小结
	本章主要介绍了本作品的研究意义，并结合国内的研究现状做了简要的分析，同时介绍了本次毕业设计主要的研究内容，最后对全文的目录结构进行了简要的介绍。

 

2 相关技术分析

2.1 前端开发技术
2.1.1 标记语言简介
标记语言，是以文本为主，将文本和其他信息结合起来，体现文档的结构和细节处理的计算机文字编码。与文本不同的是，它更有结构，更具表现力，而且用了标记对其中的元素进行了标识。
标记语言不仅仅只是一门语言，它的呈现依赖于一定的运行环境。标记语言一般可分为如下几类：表示性的标记语言、过程性的标记语言、描述性的标记语言。目前广泛使用的标记语言是超文本标记语言(HTML)和可扩展性(XML)置标语言。
在此基础之上，微信小程序的前端框架设计标签语言为WXML，即(WeiXin Markup Language)，除了基础组件之外，它还有其他更加方便灵活的新特性，例如数据绑定、条件渲染、事件等，这些都大大简化了开发难度，有效地提升了开发效率。
2.1.2 层叠样式表简介
层叠样式表(Cascading Style Sheets)，是用来表示标记语言的一种计算机语言。HTML得到快速的发展之后。功能也得到了极速的扩展，但是同时这也使得HTML文档变得越来越臃肿，1995年，CSS样式在WWW大会上提出，获得了越来越多开发者的拥护。
CSS为文档提供丰富的外观，以及设置背景、字体等属性的能力；允许任意改变文本的表现形式，简单高效，总体来说CSS具有如下的特点：样式定义丰富，易于修改、能压缩页面、能在多页面应用。
在此基础之上，微信小程序提供了类CSS样式表的一套样式语言，用来描述WXML组件的样式，WXSS具有CSS的大部分特性，同时为了更好地适应小程序的使用场景，WXSS对CSS样式进行了一定的扩充，其中包括：
1、	尺寸单位：rpx，可以根据手机宽度长度进行自适应(1rpx=1物理像素)
2、	样式导入：使用@import语句可以将外联样式表以相对路径的方式导入，简化了开发步骤，使用分号语句结尾。
2.1.3 JavaScript简介
	JavaScript是一门面向对象的编程语言，几乎支持所有的浏览器，如果说把前端比作是一个人的话，HTML就是人的骨骼，CSS就是人的皮肤，而JS则是人的神经系统。它控制着整个页面的逻辑交互。在HTML的基础上使用JavaScript可以开发许多交互式网页，使得网页具有动态性、实时性和交互性，从语法结构上来说，它与面向过程的C语言有很多相似，但它由事件驱动，而且也还具有一定的安全性。JavaScript代码短小精悍，又主要在客户机上运行，使得它在web网页程序设计中得到了极为广泛的应用。
	在此基础之上，微信小程序提供了类似JavaScript的脚本语言WXS(WeiXin Script)，结合WXML，可以构建出页面结构，在使用WXS时，需要注意以下几点：
1、	WXS与JavaScript的作用是一致的，但是语法和JS有很大的不同
2、	WXS跨版本性很强，能在所有版本的小程序上运行
3、	虽然微信小程序可以调用JavaScript，但是它们两者的运行环境也是不同的，WXS中不能调用JavaScript，在JavaScript中也不能调用小程序的API。
4、	在不同的设备上，WXS的运行效率也会有所不同，在IOS系统中，WXS比JavaScript代码块2—20倍，而在Android系统中WXS和JavaScript运行速度没有差别。

2.2 后台开发技术
2.2.1 腾讯云平台简介
	“云平台”，顾名思义开发者可以将代码上传，将代码在服务器上运行并返回相应的结果，减轻了本地的运算压力，增强了用户体验。和其他云平台不同的是，腾讯云为微信小程序提供了详尽的解决方案，其中包括以下几点：
1、	围绕微信小程序提供了推荐的服务器；
2、	能自动分配并初始化云端的资源；
3、	原生支持https/WSS，提供多重安全体系，为小程序提供安全防护体系
4、	针对小程序的技术特性，提供不同类型的demo和SDK，使开发者在案例中能快速上手。

2.2.2 PHP语言简介
	PHP(Hypertext Preprocessor)即超文本预处理语言，是在服务器端运行的一种语言，PHP的语法混合了C语言、Perl和Java语言的风格，并且由于它能嵌入到HTML代码中运行，所以能充分利用服务器的性能使得它在服务器端有非常出色的表现。CGI和PHP的功能，PHP几乎都能实现，而且支持主流的数据和操作系统，使得PHP有着广泛的应用，总结来说，PHP具有以下的特性：
1、	源代码开放；
2、	开发程序快，应用型很强；
3、	具有很强的跨平台性；
4、	执行效率很高。
2.2.3 MySql数据库简介
	MySQL数据库属于关系型数据库管理系统，关联数据库将数据保存在不同的表中，增加了灵活性。在Web应用方面，MySQL是或最好的关系型数据管理系统，其主要有如下的特性：
1、	代码移植型很强，MySQL使用C语言和C++编写；
2、	支持许多主流的操作系统；
3、	支持多线程，优化了查询算法，充分利用CPU资源；
4、	既可以作为应用程序应用在网络环境中，也可以作为库嵌入到其他的语言中。
5、	对PHP以及各种存储引擎有很好的支持
6、	MySQL还具有定制性，支持TCP/IP、JDBC等多种连接途径。

2.2.4 微信开发工具简介
	为了使开发者能高效地开发和调试小程序，微信提供了全新的微信开发者工具，它是在原来的公众号调试网页版的基础上整合了小程序的SDK，所以具有公众号和小程序两种开发模式。
 
图 2.1 微信开发者工具

选择了小程序项目，点击新建项目之后显示主界面，界面如下：
 
图 2.2 微信开发者工具主界面
	开发工具主要由菜单栏、工具栏、模拟器、编辑器、调试器组成。

2.3 本章小结
	本章主要介绍了微信小程序开发所必备的基础知识以及相关扩展，从前端用户交互设计到后台数据响应服务做了简单的介绍。其中前端包括HTML + CSS + JavaScript三大前端开发组件，对应着小程序的WXML + WXSS + WXS前端组件；后台则主要依赖腾讯云作为平台，腾讯云其中提供了后台环境的搭建；最后介绍了小程序开发的工具——微信开发者工具，既可以开发公众号，也可以开发小程序。

 

3 系统需求分析

3.1 易游小程序系统特点
	旅行早已成为人们在学习工作之余优先选择的放松方式，如今针对旅游业的互联网服务也十分丰富。无论是国内游还是出国游，都会有旅行团为游客提供各种服务，但是基于游客和导游这种在旅途中建立的这种临时关系管理系统，目前还没有一套完整的解决方案。针对这个角度出发，就有了我们这个“易游旅行助手”系统的设计初衷。易游旅行助手具有以下的功能和特点：
1、	易游小程序的针对性：针对导游和游客开发了不同的功能，导游端具有更高的权限，方便管理游客；
2、	易游小程序的实用性：除了管理功能之外，易游小程序还集合了在旅途中常用的、其他的应用难以替代的小功能，极大地方便游客的出行；
3、	易游小程序的轻量性：小程序以微信为基础，安装卸载都很简单，而且还免去的复杂的注册登录流程，在旅途结束后也可以方便地删除个人信息数据，避免了个人信息被泄露的潜在危险。
4、	易游小程序的市场性：结合使用成本以及实用的角度综合考量，能保证该系统在实际的生活中得到应用。
 
图 3.1 易游旅行小程序的系统特点

3.2 系统功能需求
	随着旅游人流量的不断增长，旅游途中安全问题、休闲方式等综合考量，易游旅行程序需要在以下几个方面满足用户的需求：
1、	易游旅行程序需要满足建立在导游——游客这种关系上的人员管理。从导游的角度上考虑，由于导游需要管理的人群人流量比较大，在旅行结束后这种关系要便于解除，所以需要有一个能高效管理游客的平台；从游客的角度上考虑，在短短的旅途中只需要对导游提供必要的联系方式即可，而且在旅途结束后可以便捷地删除在旅行中产生的用户数据，从而保护游客的隐私。
2、	易游旅行程序需要保证游客在旅途中使用的用户体验。利用各种前端技术，可以实现很多增强游客与景点、游客与导游、游客与游客之前互动性的小功能，这些功能能提升用户在旅行途中的用户体验，结合当地的特色景区，可以创造更多的特色活动，提升游客的游玩体验。
3、	易游旅行程序需要在必要时候为用户提供在旅行途中必要的救援工具。在户外活动，出现人身安全问题后，能通过小程序中集成的小工具采取急救措施。
4、	易游旅行程序需要尽可能降低用户的学习成本。需要提供简洁明了的图形化界面，尽量用图画或图标代替文字，保证各个年龄段的用户都能“拿来即用”。

3.3 用户功能需求
	1、界面需求
	本系统界面采用WXML + WXSS编写，针对用户类别的不同呈现不同的功能模块，在导游端功能按钮分别为游客管理、电子围栏、活动发布、急救知识、游客心声；在游客端功能按钮分别为开始导航、查看行程、汇率计算、电子导览、急救知识、投诉建议。界面设计严格按照微信小程序设计指南，减少了无用元素对页面的干扰，礼貌地向用户展示服务，友好地引导操作。
2、性能需求
本系统需要在移动端上应用，而移动端设备成百上千，操作系统也有差别，在设计程序时需要考虑到各个设备的差异，尽量保证在不同的系统、不同屏幕尺寸的设备上都能无差别地显示内容。同时也需要保证在不同性能的手机上都能流畅运行。
3、安全需求
程序所需要的数据是保存在服务器上，更需要我们对数据安全做好保障。防止其他非旅行用户非法窃取、伪造、篡改数据。同时也需要保护用户的隐私，能在旅途结束后彻底删除用户数据，避免旅途过后不必要的麻烦。

3.4 本章小结
	本章就易游小程序系统特点及系统和用户功能需求做了简要的分析。在系统特点上，主要介绍了本作品的针对性、实用性、轻量性、实用性和市场前景；在系统功能需求上，主要介绍了小程序需要实现的大致功能；用户功能需求则为小程序搭了一个框架，通过此可以大致了解到整个系统的功能。

 

4 系统设计

4.1 系统软件整体设计
	本作品完全基于微信开发者工具开发，使用WXML、WXSS、WXS三门语言合作完成前台界面及逻辑交互的开发；将代码部署到腾讯云上为用户提供下载安装服务；后台使用了wxappclub.com提供的后台类数据库，完成整套程序的开发。用户选择身份后注册，数据上传到后台数据库表中保存；登录后可以方便地使用各种功能，其中导游的活动发布和游客端的投诉建议将会上传到服务器保存，在旅途结束后，这些数据支持删除操作，系统整体框架见下图：























图 4.1 总体设计图
	1、服务器
	通过腾讯云保存代码到云端，使用wxappclub提供的接口访问自定义的数据库，里面保存用户信息数据、在程序使用时产生的数据等。
2、第三方API
第三方网站提供了大量接口，使用这些API可以方便地调用互联网上相关资源，需要时发起请求命令即可。
3、小程序端
在微信开发者工具中编写的前端界面以及逻辑交互、代码主要有WXML、WXSS、WXS和JavaScript。小程序的功能会在后面做详细介绍。

4.2 小程序端系统设计
4.2.1 主界面的设计
	本作品界面设计由主页面和用户界面构成。其中，主页面调用了面包旅行的API，能展示著名景点、旅途攻略等信息：
             

图 4.2 首页信息流

WXML代码如下：
 
图 4.3 主界面WXML代码

在WXS代码中，是通过引用API文件来实现request访问的，api.js文件如下：
 
图 4.4 getExplorePlace函数的定义

同样在api.js中，对wxRequsert函数进行了定义：
 
图4.6 wxRequest函数的定义
	其中，request是微信小程序中发起网络请求的唯一方法，其中重要的参数如下：
1、	url：服务器的接口地址；
2、	method：连接方式，可选参数有GET、POST、PUT、DELETE等；
3、	header：设置请求的header
4、	data：请求的参数
这样，在index.js中，我们就可以通过这个函数获取到面包旅行提供的接口信息了：
 
图 4.7 getExplorePlace函数的调用

其中，为了便于测试，采用了console.log方法获取到了接收到的res包，打开确认是我们所需要的资源，其中数据保存在data.banners和data.elements中：











图 4.8 res的数据结构

	然后在WXML中进行数据绑定，就可以引用获取到的图片或文字了。主页面中还有许多的二级界面，采用的方法大同小异，这里就不再一一介绍。

4.2.2 用户界面的设计
	在用户登录界面如下，点击用户注册之后，会有注册界面的展示：
	






















图 4.9 用户初始界面	图 4.10 注册界面

	在后台建立的关于存储用户数据库表：
Type	Key	Value
用户类型	用户姓名	用户电话号码
表 4.1 用户数据表
注册的逻辑加下图：
 
图 4.11 用户注册逻辑

	该功能的代码实现如下：
	 
图 4.12 注册的实现逻辑1

   
 
图 4.13 注册的实现逻辑2

	首先，进行WXML数据绑定，获取到用户填写的信息存放在userName、teleNumber和userType中；然后首先使用正则表达式来判断用户输入的手机号码是否合法，这样可以减少服务器的负担，并且保证用户提交数据的质量；接着使用wxappclub提供的match方法来对表中的数据进行遍历比较，如果没有相同的数据返回true，否则返回false。当返回值为false后，则表示数据库中没有重复的元素，可以将其添加到表中，于是再使用wxappclub提供的put方法来将其填写的数据写入，从而达到简单的注册功能。
	登录逻辑则和用户注册逻辑相反，使用wxappclub提供的match方法，如果返回true则可以登录，返回false表示用户名或电话号码输入错误，这里将不再赘述。


4.2.3 游客端功能模块设计
	在游客端，一共有如下的功能模块：



























图 4.14 游客端主界面

接下来逐一介绍各个功能模块的具体实现：
1、“开始导航”模块的实现
	在表现层，添加了一个地图标签，设置好宽度和高度：
 
图 4.15 导航WXML代码

	在逻辑层，获取用户当前的位置主要由以下代码实现：


 
图 4.16 导航WXS代码

其中，getLocation是微信提供的获取用户当前位置的API，它在调用完成之后会返回一些参数，主要有：
1）	latitude：经度
2）	longitude：纬度
3）	accuracy：位置的精确度等
markers用来标记当前位置，将获取到的位置传值给markers中的latitude和longitude即可实现实时定位。










图 4.17 markers赋值
	最终呈现出如下的效果：
 
图 4.18 地图导航

2、“汇率计算”模块的实现
	在表现层，将标签内容的数据与逻辑层绑定，这样就可以通过修改逻辑层的数据来显示不同的数据：

	





图 4.19 汇率转换前端代码

用户在点击汇率转换功能之后，跳转到汇率计算界面，同时用户也可以根据自己需要添加常用国家的汇率转换。
      
图4.20 汇率转换界面

	汇率转换的基本实现为，当用户选择相应的国家或地区时，程序先将绑定的数据转化为JSON格式的数据流，并作为参数向服务器发起请求，请求成功时服务器将会把返回的参数保存到res中提供调用，res的数据结构为：









图 4.21 res的数据结构

	其中，主要的内容保存在res.data中，以下是各个参数的详细说明：
1）	amount：存放当前计算出的汇率价格
2）	name：添加的国家名称代码
3）	rate：当前和主货币之间的汇率
 
图 4.22 汇率计算

	同时，为了完善用户体验调用了本地存储，用户添加的国家或者地区记录会保存到本地，下次启动时能自动读取并显示，免去了用户再一次添加的复杂流程，其实现的关键在与setStorage方法，该方法需要两个参数：key和data。其中key保存的值相当于变量名，data中保存的值相当于变量本身，在调用的时候使用getStorage方法传递key值即可获取到保存到本地的数据，其实现关键代码如下：
 
图 4.23 获取本地存储

3、“电子导览”模块的实现
	在实际的游玩过程中，我们常常可以看见人文景区中，会有导游做介绍，有些地方也有了“扫码”获取景点的语音介绍，这一功能在“易游旅行助手”中也有所集成，本作品通过调用秦始皇兵马俑景区提供的API，实现了语音导览以及扫码获取语音讲解的功能。用户点击电子导览后显示的主界面如下：
          
图 4.24 电子导览主界面
	该界面的表示层代码如下：
 
图 4.25 电子导览前端代码

用户通过点击不同的按钮即可获取到不同景区的详细介绍，其主要实现方法和首页的信息流类似，通过request方法来获取兵马俑官方网站获取的API，其主要实现代码如下：


















	图 4.26 电子导览WXS代码

	通过对res的输出，可以看出其返回值数据的封装情况：
 
图 4.27 res的数据结构

 
图 4.28 数据请求

	对数据的请求，还是采用的request方法，并采用了正则表达式对原数据进行了处理获取到正确的文本。在用户点击播放按钮时，将获取到的音频文件播放，通过createAudioContent来创建一个音频组件，该对象的主要方法有：setSrc（音频地址）、paly（播放）、pause（暂停）等，具体实现代码如下：
 
图 4.29 语音播放

 
图 4.30 播放与暂停的逻辑交互

	当然，我们也可以选择在主界面点击扫一扫来获取图文信息，扫到对应的信息后页面跳转如下：
      
图 4.31 扫码获取图文信息
	先将页面信息的字符串转化成二维码，主要使用了scanCode方法，它所返回的errMsg，参数类型为String，用户在扫码后就能获取页面信息，再将其作为参数信息传递，即可实现扫码获取指定信息的功能。

4、“用户反馈”模块的实现
	用户反馈主要是将，用户输入的text文本上传到服务器，同时在导游端可以从后台服务器获取用户的投诉或是建议信息，此信息除后台管理员外其他用户组没有权限删除。前端代码如下：
 
	图 4.32 用户反馈WXML代码

逻辑层的关键代码如下：
 
	图 4.33 用户反馈WXML代码

	在后台建立的关于存储反馈数据库表：
Type	Key	Value
Default	用户姓名	反馈信息@发表时间
表 4.2 反馈数据表

在这里，将用户发送的投诉建议内容和发送的时间进行了封装，用“@”符号进行分开，在导游端进行数据处理时，使用了split方法对字符串进行拆分，从而获取正确的数据，导游端的数据处理关键代码如下：
 
图 4.34 导游端用户反馈WXS代码

4.2.4 导游端功能模块设计
	在导游端，一共有如下的功能模块：
 
图 4.35 导游端主界面

	接下来将逐一介绍各个功能的具体实现：
1、“游客管理”模块的实现
	在用户进行登记之后，导游在该界面即可看见所有注册的并选择了游客身份的用户信息，可查看的信息只有姓名和密码，防止多余的信息被泄露。前端表示层的代码如下：
 
图 4.36 游客管理WXML代码

	在数据绑定之后，通过wxappclub的list请求即可获取到type为“yk”的用户，并返回res数据，res数据的格式如下：
 
图 4.37 res数据结构

	在WXS代码中，只需要在数据获取成功之后将绑定数据赋值就可以了，其关键代码如下：
 
图 4.38 游客管理WXS代码

最后，在导游端的界面如图所示：
         
图 4.39 游客管理主界面

	点击用户标签，还可以进行拨打电话和删除用户的操作，实现也非常简单，关键代码如下：
 
图 4.40 菜单交互WXS代码
2、“电子围栏”模块的实现
	本作品的电子围栏，目前只实现了对某一位游客的有效管理，具体的实现方式为：
	在游客端打开导航时，每间隔一段时间，就会把自己所处的经纬度上传到服务器，导游在打开电子围栏时，将会用自己所处的经纬度进行比较，超过之前设定的距离后在导游端将会有提示，其前端WXML代码及后台WXS关键代码如下：
 
图 4.41 电子围栏WXML代码

 
图 4.42 电子围栏WXS代码


3、“活动发布”模块的实现
	在前端表示层编写前端代码，其中使用到了input、picker等输入标签，能让导游对活动时间、活动地点、活动地图、活动类型、活动详情进行详细设置，代码如下：
 
图 4.43 通知发布WXML代码

	在导游填写好所有的数据，点击提交按钮之后，程序会将其绑定的数据进行重新组合，组合的结果为对应于数据库中的表的情况如下表所示：
Type	Key	Value
Default	活动名称	时间@地点@内容@经度@纬度@类别
表 4.3 活动数据表
与活动发布的原理类似，在游客端将会对value的值进行拆分，其关键代码如下：
 
图 4.44 查看活动WXS代码

	在游客端，每当发布了新的活动时，只需要下拉即可请求数据，实现这一功能主要是依赖微信开发提供的下拉刷新API，其实现方法如下：
	在onPullDownRefresh方法编写下拉后需要执行的代码，监听用户事件，同时需要在stopPullDownRefresh编写相关处理代码，用来保证下拉刷新得以正常停止。代码如下：
 
图4.45 下拉刷新实现原理

4、“急救知识”模块的实现
	在旅行的过程中，难免会发生意外，本作品提供了在紧急救助时的一系列操作流程，能在意外发生时科学有效地帮助到伤者，具体设计如下：
	在前端界面引导用户对伤者进行简单的急救，其中主要以插入gif图做示例演示为主。
      
图 4.46 急救流程

在最后，当一般的救助无效时，可以拨打急救电话。但是与直接拨打电话不同的是，在拨号按钮上会显示当前的详细地址，精确到道路，方便向救护车描述详细位置，具体实现方式为在逻辑交互层调用了百度地图API，关键代码如下：
 
图 4.47 百度地图API


4.3 小程序后台设计
4.3.1 后台数据总体设计
	本次毕业设计后台采用的是wxappclub推出的云端后台服务，并提供了常用的API供开发者调用，方便快速，本作品通过建立三个数据库表格来完成对用户个人信息数据、活动发布数据以及游客反馈数据的存储。
	 
图 4.48 小程序后台数据库

	对表的引用主要是通过APPkey来实现的，其具体的API有如下：
Put	将数据写到表中
Get	获取表中指定的数据
Del	删除表中指定的数据
Match	数据匹配
List	列表读取
表 4.3 后台API

调用API的格式示例代码如下：
 
图 4.49 API后台调用格式

	需要注意的是，URL填写时二级目录需要根据自己的实际需求，appkey需要填写对应的数据区码。

4.3.2 数据库表的设计
	本作品一共建立了三张数据库表，其详细设计如下：
1、	用户信息表的设计
Type	Key	Value
用户类型	用户姓名	用户电话号码
表 4.4 用户数据表

2、	游客反馈信息表的设计
Type	Key	Value
Default	用户姓名	反馈信息@发表时间
表 4.5 反馈数据表

3、	导游活动发布表的设计
Type	Key	Value
Default	活动名称	时间@地点@内容@经度@纬度@类别
表 4.6 活动数据表

4.4 本章小结
	本章对本作品各个功能模块的具体实现做了详尽的分析，将作品分为前端和后台分开进行介绍，在前端部分，依次介绍了小程序的主界面、用户界面、以及导游端和游客端功能的各个模块；在后台部分，介绍了后台提供的常用API和数据库表的设计。

 

5 系统测试

5.1 实验环境和实验设备
5.1.1 实验环境
	本作品主要利用微信开发者工具以及wxappclub.com后台进行开发，目前小程序提交审核已经通过，开发版本为1.4，线上版本为1.0，周围的同学和朋友也对小程序进行了测试，提出了一些优化意见，在后续的版本中将会继续更新完善。
 
图 5.1 小程序访问量

	小程序详细信息：
开发者ID	wx01abd9c07e59c205
Request合法域名	https://qcloud.bmy.com.cn
https://wapp.talk-easy.cn
https://apis.map.qq.com
https://api.breadtrip.com
https://api.wxappclub.com
https://api.map.baidu.com
表 5.1 小程序设置信息
5.1.2 实验设备
	由于已经开放了线上版本，小程序得以在Android和IOS移动端的各种设备上运行，目前在各设备和系统上能正常运行，没有出现兼容性问题。以下的实验过程是选择本人的手机(MI5s,Android 6.0)进行的详细测试。（注：本章的只测试特殊功能，其他功能在模拟器上的表现与手机一致，故不重复参与测试）
5.2 实验过程
5.2.1 主界面信息流展示

	由图所示，能正确请求到面包旅行的数据并返回：
       

       
图 5.2 首页信息流

5.2.2 用户登录注册模块测试
	用户输入姓名和电话号码时，若输入内容合法，则会提示注册成功，同时在后台数据库可以查找到相应的数据记录：
       
图 5.3 用户注册测试

 
图 5.4 后台数据

登录测试与注册测试类似，这里就不再赘述。
其他的功能在系统测试中就已经进行过测试，这里也不再重复测试。

5.2.3 游客端各功能模块测试
	1、“地图导航”模块
	地图界面正常显示，右侧还有放大缩小按钮，能对地图进行简单的缩放操作。

 
图 5.5 地图导航

	2、“查看活动”模块
	当导游发布活动并上传到服务器时，在游客端即可看见发布的活动，每个活动都附有地图：
 
图 5.6 活动发布

其他模块的界面在第四章系统设计中都有所展示，故不再赘述。

5.2.4 导游端各功能模块测试
	1、“活动发布”模块
	导游发布活动的页面详情如下，在编辑好活动后点击发布，在后台将会创建数据，在游客端可正确显示：
       
图 5.7 活动发布

	在数据库中生成的内容如下：
 
图 5.8 活动发布后台数据

	2、“急救知识”模块
	在之前我们已经介绍了急救知识模块的系统设计，其中已经包括了急救常识，本部分只用来测试百度API的定位功能。
	在校门口测试，显示了街道，说明百度API可以使用：
 
图 5.9 急救电话

其他的功能在第四章系统测试中就已经进行过测试，这里也不再重复测试。

5.3 本章小结
	本章对一些特殊的功能在移动端进行了测试，实验证明系统运行正常，前端正确显示，逻辑层交互友好正确，后台数据库能正确保存数据、数据读取和删除功能一切正常。美中不足的就是电子围栏功能还不是太完善，目前没有想到更好的解决办法。

 

6 总结

6.1 工作总结
由于四年本科的教学计划中基本没有接触过本次毕业设计所需的各种知识，所以在一开始面对这个研究内容时还是面临着一些困难，还好自己沉住了气，一步一个脚印通过自己的自学顺利实现了开题报告中所要求的相关功能，本作品主要提供了以下功能：
1.人员管理：通过建立不同的用户类型得以获取不同的用户权限，导游能对游客科学而便捷地管理，同时又充分保证了游客的隐私，这是本作品的一大亮点。
2.功能集合：针对不同的用户，提供不同的功能模块以供使用，体现了用户的针对性，增强了用户体验。

6.2 工作展望
本次课程设计还是有一些问题没有解决，在导游端的电子围栏模块中，将所有游客添加到导游监控中时，会导致小程序的导游端不稳定，同时也加大了服务器的压力。
当然，电子围栏可能还有更好的算法或是模型来解决，知识目前的知识储备还不够，加之时间也很有限，因此可能还没有找到最好的解决方案，这是本作品的一大遗憾。
与此同时，小程序在很多逻辑交互上还很生硬，由于时间有限，来不及一步步优化，但是由于小程序开发的便捷性，我相信在毕业之后，我依然会继续在空余时间作为兴趣爱好不断完善，以提高用户体验。

 

参考文献

[1] 杨杰. 基于微信公众平台校园服务公众号的设计与实现[D]. 华中师范大学, 2015
[2] 李锦程. 基于微信平台的医疗就诊系统设计与实现[D]. 哈尔滨工业大学, 2015
[3] 丁丽静. 基于微信公众平台的华文教师学习社区的设计与研究[D]. 暨南大学, 2015
[4] 刘向南. 小程序时代[M]. 清华大学出版社, 2017
[5] 王志刚. HTML5移动开发即学即用[M]. 电子工业出版社, 2012
[6] 刘玉红. HTML+CSS3网页设计与制作案例课堂[M]. 清华大学出版社, 2015
[7] 郭蕊. 21天学通JavaScript[M]. 电子工业出版社, 2014
[8] 易伟. 微信公众平台搭建与开发揭秘[M]. 机械工业出版社, 2015
[9] 刘捷. 微信公众平台企业应用开发实战[M]. 电子工业出版社, 2015
[10] 方倍工作室. 微信公众平台开发最佳实践[M]. 机械工业出版社, 2014
[11] 闫小坤,周涛. 微信公众平台开发基础与实战[M]. 机械工业出版社, 2014
[12] 申鸿烨. 微信架构下网络学习平台的学习路径设计与实现研究[J]. 智能计算机与应用, 2017(01):86-88.
[13] 付强. 深度挖掘CSS(层叠样式表)样式选择符[J]. 科技情报开发与经济. 2010(20):142-146
[14] 杨旭东. 腾讯云,一云多端——助力应急广播连接一切[J]. 中国广播, 2015(12):16-17
[15] 王卫华. 下一代的浏览体验——话说HTML5、CSS3[J]. 电脑迷, 2010(19):6-8
[16] 吴光华,闫怀海,陈又新,黄玉珍,周忠祖,高大庆. 嵌入式数据库MySQL在兰州重离子加速器数字化电源上的应用[J]. 核技术, 2014(05):53-57
[17] 肖卓明,吴娴. 浅谈小程序在媒体的应用[J].中国传媒科技, 2017(02):120-121
[18] 马力. 基于JavaScript和Java语言的动态网页设计方法[J]. 计算机光盘软件与应用. 2014(21):213-214
[19] 李刚. 一种基于JavaScript的Web网页特效实现方法[J]. 信阳师范学院学报(自然科学版). 2002(01):4
[20] Che Hui Lien,Yang Cao. Examining WeChat users’ motivations, trust, attitudes, and positive word-of-mouth: Evidence from China[J]. Computers in Human Behavior . 2014:21-23
[21] Cabral,Sheeri K. MySQL 5.5: Improving on the World’s Most Popular Open Source Database[J]. Database Trends and Applications. 2011 (3):14-15
 

致谢

四年的大学的学习生涯、一年的考研历程、两个月的毕业设计背后是一日日默默地付出，最后还算为自己给自己交上了一份满意的答卷。当然，在这一路上很多的人给予了我至关重要的帮助。
首先便要感谢易军老师，在此次毕业设计中对我进行全方位有效的技术支持与指导，以及黄迪学长，在我的毕业设计最迷茫的时候给予了我一些指导，让我顺利度过了毕业设计的艰难时期。
其次，感谢大学四年来，所有将自身学识倾心相授的所有教师们，你们不仅教授了我宝贵的知识，更教会了如何去独立学习、独立思考，更重要的是给了我在逆境挫折中一次次站起来的勇气。
然后，感谢大学四年来和我朝夕相处的同学和朋友们，感谢你们在毕业设计这段时间，当我遇到困难时，及时能够给以我帮助，能够让我最终解决各种细节问题；在我的作品完成时，积极地帮我测试，提出了很多宝贵的意见，感谢你们的帮助。
最后，感谢在百忙之中能够挤出时间对本文进行评阅的专家及老师们，感谢学校及学院在四年来为我们提供先进的实验设备及舒适的实验环境。由于本人在此次毕业设计中能力有限，如有不足之处，恳请各位老师能够指正。
</textarea>
			</form>
		</div>
		<div id="full-text">
			<iframe src="full-text.html"></iframe>
		</div>
		<div id="simi-result">
			<iframe src="full-text-report-welcome.html" name="resultFrame"></iframe>
		</div>
		<iframe name="papermodifyFrame" border="0" width="0" height="0"></iframe>
	</body>
</html>
